<section class="collections-header">
  <div class="w-full md:w-auto pb-[1rem]">
    <div
      class="collections-header__inner flex justify-between"
      [class.search-active]="isMobileSearchActive()"
    >
      @if (!isMobileSearchActive()) {
        <h2 class="collections-header__title">Коллекции</h2>
      }

      <div class="flex items-center space-x-2 md:hidden">
        @if (!isMobileSearchActive()) {
          <button
            type="button"
            class="collections-header__icon-button rounded text-[#1abc9c] hover:bg-[#f6f7f7]"
            (click)="activateMobileSearch()"
            aria-label="Открыть поиск"
          >
            <svg
              viewBox="0 0 512 512"
              xmlns="http://www.w3.org/2000/svg"
              fill="#1abc9c"
              role="img"
              aria-hidden="true"
            >
              <path
                d="M368 208A160 160 0 1 0 48 208a160 160 0 1 0 320 0zM337.1 371.1C301.7 399.2 256.8 416 208 416C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208c0 48.8-16.8 93.7-44.9 129.1L505 471c9.4 9.4 9.4 24.6 0 33.9s-24.6 9.4-33.9 0L337.1 371.1z"
              />
            </svg>
          </button>
        }
        @if (!isMobileSearchActive()) {
          <div class="relative">
            <button
              id="plus-button"
              aria-haspopup="true"
              [attr.aria-expanded]="menuOpen()"
              class="rounded text-[#1abc9c] hover:bg-[#f6f7f7] relative p-[4px]"
              aria-label="Open new item menu"
              (click)="toggleMenu()"
              type="button"
            >
              <svg
                xmlns="http://www.w3.org/2000/svg"
                viewBox="0 0 448 512"
                fill="currentColor"
                class="w-3 h-3"
              >
                <path
                  d="M248 72c0-13.3-10.7-24-24-24s-24 10.7-24 24l0 160L40 232c-13.3 0-24 10.7-24 24s10.7 24 24 24l160 0 0 160c0 13.3 10.7 24 24 24s24-10.7 24-24l0-160 160 0c13.3 0 24-10.7 24-24s-10.7-24-24-24l-160 0 0-160z"
                ></path>
              </svg>
            </button>

            <ul
              *ngIf="menuOpen()"
              class="absolute bottom-[-100px] right-0 w-48 bg-white shadow-lg py-2 text-gray-700 z-50"
              role="menu"
              aria-label="New item menu"
            >
              <li
                class="flex items-center text-sm font-normal tracking-normal leading-[1.7] px-4 py-2 cursor-pointer hover:bg-gray-100"
                role="menuitem"
                (click)="onNewCollection()"
              >
                <svg
                  class="w-3 h-3 mr-[8px]"
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="far"
                  data-icon="folder-image"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                  as="span"
                  hasHover="false"
                >
                  <path
                    class=""
                    fill="currentColor"
                    d="M251.7 127.6s0 0 0 0c10.5 10.5 24.7 16.4 39.6 16.4L448 144c8.8 0 16 7.2 16 16l0 256c0 8.8-7.2 16-16 16L64 432c-8.8 0-16-7.2-16-16L48 96c0-8.8 7.2-16 16-16l133.5 0c4.2 0 8.3 1.7 11.3 4.7l33.9-33.9L208.8 84.7l42.9 42.9zm33.9-33.9L242.7 50.7c-12-12-28.3-18.7-45.3-18.7L64 32C28.7 32 0 60.7 0 96L0 416c0 35.3 28.7 64 64 64l384 0c35.3 0 64-28.7 64-64l0-256c0-35.3-28.7-64-64-64L291.3 96c-2.1 0-4.2-.8-5.7-2.3zM160 208a32 32 0 1 0 -64 0 32 32 0 1 0 64 0zm155.2 9.6c-4.5-6-11.6-9.6-19.2-9.6s-14.7 3.6-19.2 9.6l-54.2 72.2L202.7 265c-4.6-5.7-11.5-9-18.7-9s-14.2 3.3-18.7 9l-64 80c-5.8 7.2-6.9 17.1-2.9 25.4s12.4 13.6 21.6 13.6l80 0 48 0 144 0c9.1 0 17.4-5.1 21.5-13.3s3.2-17.9-2.3-25.1l-96-128z"
                  ></path>
                </svg>
                New Collection
              </li>
              <li
                class="flex text-sm font-normal tracking-normal leading-[1.7] items-center px-4 py-2 cursor-pointer hover:bg-gray-100"
                role="menuitem"
                (click)="onNewFolder()"
              >
                <svg
                  class="w-3 h-3 mr-[8px]"
                  aria-hidden="true"
                  focusable="false"
                  data-prefix="far"
                  data-icon="folder"
                  role="img"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 512 512"
                  as="span"
                  hasHover="false"
                >
                  <path
                    class=""
                    fill="currentColor"
                    d="M0 96C0 60.7 28.7 32 64 32l132.1 0c19.1 0 37.4 7.6 50.9 21.1L289.9 96 448 96c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 480c-35.3 0-64-28.7-64-64L0 96zM64 80c-8.8 0-16 7.2-16 16l0 320c0 8.8 7.2 16 16 16l384 0c8.8 0 16-7.2 16-16l0-256c0-8.8-7.2-16-16-16l-161.4 0c-10.6 0-20.8-4.2-28.3-11.7L213.1 87c-4.5-4.5-10.6-7-17-7L64 80z"
                  ></path>
                </svg>
                New Folder
              </li>
            </ul>
          </div>
        }
      </div>
      @if (isMobileSearchActive()) {
        <label class="collections-header__search-label bg-[#f6f7f7]">
          <button
            type="button"
            class="collections-header__icon-button"
            (click)="closeMobileSearch()"
            aria-label="Закрыть поиск"
          >
            <svg
              class="svg-inline--fa fa-arrow-left relative text-[0.667em]"
              aria-hidden="true"
              focusable="false"
              data-prefix="far"
              data-icon="arrow-left"
              role="img"
              xmlns="http://www.w3.org/2000/svg"
              viewBox="0 0 448 512"
            >
              <path
                fill="currentColor"
                d="M7.4 273.4C2.7 268.8 0 262.6 0 256s2.7-12.8 7.4-17.4l176-168c9.6-9.2 24.8-8.8 33.9 .8s8.8 24.8-.8 33.9L83.9 232 424 232c13.3 0 24 10.7 24 24s-10.7 24-24 24L83.9 280 216.6 406.6c9.6 9.2 9.9 24.3 .8 33.9s-24.3 9.9-33.9 .8l-176-168z"
              ></path>
            </svg>
          </button>

          <input
            id="search-bar"
            class="collections-header__search-input"
            type="text"
            placeholder="Поиск..."
            [value]="searchTerm()"
            (input)="onInput($event)"
          />

          @if (searchTerm()) {
            <button
              class="collections-header__clear-button"
              type="button"
              (click)="searchTerm.set('')"
              aria-label="Очистить поиск"
            >
              ×
            </button>
          }
        </label>
      }
    </div>

    <div class="md:hidden mt-2 float-right md:float-none">
      <app-sort-dropdown [sort]="sort()" (sortChange)="onSortChange($event)"></app-sort-dropdown>
    </div>
  </div>

  <div class="flex items-center gap-4 hidden md:flex">
    <!--<a
      class="collections-header__control-link"
      [class.collections-header__control-link_disabled]="isPresetsDisabled"
      [attr.aria-disabled]="isPresetsDisabled"
      [routerLink]="!isPresetsDisabled ? '/settings/presets' : null"
      (click)="isPresetsDisabled && $event.preventDefault()"
    >
      Просмотреть пресеты
    </a>-->

    <button class="collections-header__control-button" (click)="createNewCollection()">
      Новая Коллекция
    </button>
  </div>
</section>
