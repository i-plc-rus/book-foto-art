<section class="public-collection p-4 md:p-6">
  <div class="w-full mb-4 md:mb-6 flex items-center justify-between gap-3">
    <h1 class="text-xl font-medium leading-[1.3]">Медиа файлы</h1>

    <div class="flex items-center gap-2">
      <app-sort-menu (sortChange)="onSortChange($event)"></app-sort-menu>

      <app-grid-settings
        (gridSizeChange)="onGridSizeChange($event)"
        (showFilenameChange)="onShowFilenameChange($event)"
      ></app-grid-settings>
    </div>
  </div>

  @defer (when (isLoading$ | async) === false; prefetch on idle) {
    @let files = files$ | async;

    @if ((files?.length ?? 0) === 0) {
      <div class="empty-state flex flex-col items-center justify-center py-16 text-center">
        <img src="assets/images/empty/empty-photos.svg" alt="" class="w-24 h-24 opacity-70 mb-4" />
        <div class="text-lg font-medium mb-1">Здесь пока пусто</div>
        <div class="text-sm opacity-70">Добавьте фотографии или поменяйте сортировку</div>
      </div>
    } @else {
      <div class="grid-wrapper" [class.grid-large]="(gridSize$ | async) === 'large'">
        <app-file-grid
          [files]="files"
          [showFilename]="(showFilename$ | async) === true"
          (imageError)="handleImageError($event)"
        ></app-file-grid>
      </div>
    }
  } @placeholder {
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
    </div>
  } @loading {
    <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4 animate-pulse">
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
      <div class="skeleton h-32 md:h-44 rounded-xl"></div>
    </div>
  } @error {
    <div class="p-4 rounded-xl border border-red-300 bg-red-50 text-red-800">
      Не удалось отрисовать медиа-галерею. Обновите страницу или попробуйте позже.
    </div>
  }
</section>
