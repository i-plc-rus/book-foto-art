<div
  class="upload-area h-auto md:h-[100%]"
  [class.centered]="files.length === 0"
  (drop)="handleDrop($event)"
  (dragover)="$event.preventDefault()"
>
  @if (showEmptyState) {
    <div class="empty-state">
      <p class="drop-text">Перетащите медиафайлы сюда или</p>
      <label for="fileInput" class="file-label">выберите на устройстве</label>
      <input
        type="file"
        multiple
        hidden
        id="fileInput"
        (change)="handleFileSelect($event)"
      />
    </div>
  } @else {
    <div
      class="file-grid"
      [class.grid-small]="gridSize === 'small'"
      [class.grid-large]="gridSize === 'large'"
    >
      @for (file of files; track file.id) {
        <div class="file-tile group relative">
          <div class="media-container">
            @if (!file.loaded) {
              <div class="skeleton-loader"></div>
            }

            <div class="media-content relative">
              <img
                [src]="file.previewUrl"
                [alt]="file.file.name"
                [class.hidden]="!file.loaded"
                (error)="handleImageError($event, file)"
                class="w-full h-full object-cover"
              />

              @if (!file.loaded && !file.error) {
                <div class="loader-overlay">
                  <div class="percentage">Processing</div>
                </div>
              }

              @if (file.loaded) {
                <div
                  class="absolute top-0 right-0 w-7 h-7 flex items-center justify-center bg-white/80 backdrop-blur-sm cursor-pointer transition-opacity duration-200 z-10"
                  [class.opacity-100]="menuOpenId() === file.id"
                  [class.opacity-0]="menuOpenId() !== file.id"
                  [class.group-hover:opacity-100]="menuOpenId() !== file.id"
                  (click)="toggleMenu(file.id, $event)">
                  <svg xmlns="http://www.w3.org/2000/svg" class="w-4 h-4 text-gray-600" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="6" r="1.5" fill="currentColor"/>
                    <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
                    <circle cx="12" cy="18" r="1.5" fill="currentColor"/>
                  </svg>
                </div>
              }

              @if (showFilename) {
                <p class="filename">{{ file.file.name }}</p>
              }
            </div>
          </div>

          @if (menuOpenId() === file.id) {
            <div class="menu-container absolute top-[28px] right-[0] z-50 bg-white/70 backdrop-blur-md shadow-lg min-w-[220px]">
              @for (option of menuOptions; track option.id) {
                <div
                  class="menu-option flex items-center gap-2.5 px-[1.5rem] py-2.5 hover:bg-gray-100 cursor-pointer relative"
                  (mouseenter)="option.subMenu ? onMenuOptionMouseEnter(option.id) : null"
                  (mouseleave)="option.subMenu ? onMenuOptionMouseLeave() : null"
                  (click)="!option.subMenu && handleOptionClick(option.id, file)"
                >
                  <img
                    [src]="option.iconUrl"
                    alt=""
                    class="w-4 h-4 object-contain"
                  />
                  <span>{{ option.name }}</span>

                  @if (menuHoverId() === option.id && option.subMenu) {
                    <div class="submenu absolute top-0 left-full bg-white/90 shadow-lg min-w-[220px] z-50">
                      @for (subOption of option.subMenu; track subOption.id) {
                        <div
                          class="menu-option flex items-center gap-2.5 px-[1.5rem] py-2.5 hover:bg-gray-100 cursor-pointer"
                          (click)="handleOptionClick(subOption.id, file)"
                        >
                          <img
                            [src]="subOption.iconUrl"
                            alt=""
                            class="w-4 h-4 object-contain"
                          />
                          <span>{{ subOption.name }}</span>
                        </div>
                      }
                    </div>
                  }
                </div>
              }
            </div>
          }
        </div>
      }
    </div>
  }
</div>
